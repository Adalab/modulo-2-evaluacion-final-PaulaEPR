"use strict";const form=document.querySelector(".js-search"),input=document.querySelector(".js-input"),mainFav=document.querySelector(".js-main-fav"),mainRes=document.querySelector(".js-main-res"),deleteAllFav=document.querySelector(".js-delete-all");let favorite=[],result=[];function getData(){const e=input.value.replace(" ","%20");fetch("https://api.jikan.moe/v3/search/anime?q="+e).then(e=>e.json()).then(e=>{result=e.results,createResults(),checkSelected()})}function saveFav(){localStorage.setItem("fav",JSON.stringify(favorite))}function getFav(){const e=localStorage.getItem("fav");null!==e&&(favorite=JSON.parse(e),createFavs())}function createTagJS(e,t,a){const c=document.createElement(e);return c.classList.add(t),c.classList.add(a),c}function createTagCSS(e,t){const a=document.createElement(e);return a.classList.add(t),a}function createBkgImgArticle(e,t,a){const c=createTagJS("article","res__card","js-article"),n=createTagCSS("h5","res__card--title"),s=document.createTextNode(e);return c.dataset.id=a,n.appendChild(s),c.appendChild(n),setBkg(c,t),c}function setBkg(e,t){t.includes("qm_50.gif")||t.includes("questionmark")||""===t?e.style.background="url('https://via.placeholder.com/225x350/fff/666/?text=No+Picture') center bottom / cover no-repeat":e.style.background=`url('${t}') center bottom / cover no-repeat`}function createListArticle(e,t,a){const c=createTagCSS("article","fav__card");c.dataset.id=a;const n=createTagCSS("img","fav__card--img");n.src=t;const s=createTagCSS("h5","fav__card--title"),r=document.createTextNode(e);s.appendChild(r);const i=createTagJS("button","fav__card--button","js-delete-fav");i.dataset.id=a;const l=createTagCSS("img","fav__card--icon");return l.src="./assets/images/icons/delete.svg",i.appendChild(l),c.append(n,s,i),c}function createResults(){const e=createTagJS("section","res","js-results");for(const t of result){const a=createBkgImgArticle(t.title,t.image_url,t.mal_id);e.appendChild(a)}mainRes.appendChild(e),listenerCards()}function createFavs(){eraseSection(".js-favorites",mainFav);const e=createTagJS("section","fav","js-favorites");for(const t of favorite){const a=createListArticle(t.title,t.image_url,t.mal_id);e.appendChild(a)}mainFav.appendChild(e),listenDeleteBtns()}function handleClickSubmit(e){e.preventDefault(),document.querySelector(".js-results")&&eraseSection(".js-results",mainRes),getData()}function listenerClickSubmit(){form.addEventListener("submit",handleClickSubmit)}function handleClickReset(){input.focus(),result=[],eraseSection(".js-results",mainRes),listenerClickSubmit()}function handleClickCard(e){const t=e.currentTarget,a=t.dataset.id;t.classList.toggle("res__card--selected"),checkFavorite(a),createFavs(),saveFav()}function listenerCards(){const e=document.querySelectorAll(".js-article");for(const t of e)t.addEventListener("click",handleClickCard)}function handleDeleteAllFavs(){localStorage.removeItem("fav"),favorite=[],createFavs()}function handleDeleteFav(e){checkFavorite(e.currentTarget.dataset.id),saveFav(),createFavs()}function listenDeleteBtns(){const e=document.querySelectorAll(".js-delete-fav");for(const t of e)t.addEventListener("click",handleDeleteFav)}function checkFavorite(e){if(void 0===favorite.find(t=>t.mal_id===parseInt(e))){const t=result.find(t=>t.mal_id===parseInt(e));favorite.push(t)}else{const t=favorite.findIndex(t=>t.mal_id===parseInt(e));favorite.splice(t,1)}}function eraseSection(e,t){t.removeChild(document.querySelector(e))}function checkSelected(){for(const e of result)for(const t of favorite)e.mal_id===t.mal_id&&toggleSelectedClass(e.mal_id)}function toggleSelectedClass(e){const t=document.querySelectorAll(".js-article");for(const a of t)e===parseInt(a.dataset.id)&&a.classList.toggle("res__card--selected")}form.addEventListener("reset",handleClickReset),deleteAllFav.addEventListener("click",handleDeleteAllFavs),getFav(),listenerClickSubmit();